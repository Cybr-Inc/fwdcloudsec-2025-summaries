# I Didnt Register for This: Whats Really in Googles Artifact Registry?

**Video Link**: [Watch on YouTube](https://www.youtube.com/watch?v=hHe9cKfSfqI)

- **Author**: Moshe Bernstein (Tenable Cloud Security)
- **Talk Type**: Security

## Summary

This presentation reveals the findings from a comprehensive security analysis of over 3,000 container images owned by Google on their Artifact Registry platform. The research uncovered significant security vulnerabilities and exposed secrets in images that are trusted by users due to Googles association, highlighting serious gaps in the shared responsibility model for cloud marketplace security.

## Key Points

- Scanned 3,000+ Google-owned container images across 32 repositories using permission discrepancy bypass techniques
- Found 1.7 million total vulnerabilities including 380,000+ high/critical severity issues
- Discovered infamous vulnerabilities like Log4Shell, ZeroLOG, and Spring4Shell in multiple Google-associated images
- Identified nearly 3,000 exposed secrets including cloud credentials, API keys, and hardcoded passwords
- Security company offering vulnerability scanning had 24 critical vulnerabilities in their own marketplace image
- Shared responsibility model creates gaps where neither Google nor vendors take full ownership of image security
- Three categories of Google images: vetted (marketplace), offered (convenience), and used (production)

## Technical Details

**Research Methodology:**
- Started from Google Composer tenant project discovery containing production-deployed images
- Used organizational ID tags to identify Google-owned images (ID starting with 433)
- Exploited permission discrepancy between gcr.io and docker.pkg.dev domains to bypass access restrictions
- Created automated discovery pipeline for finding and scanning additional images

**Image Classification System:**

1. **Vetted Category (70% of images)**:
   - GCP Cloud Marketplace offerings created by third parties but curated by Google
   - High trust level due to Google platform association
   - Worst security offenders in the study

2. **Offered Category**:
   - Base images provided by Google for user convenience (OS images, AI training images)
   - Not used in production but offered as trusted starting points
   - High trust level due to Google authorship

3. **Used Category**:
   - Images created by Google for their own production services
   - Automatically deployed in user environments without user awareness
   - Very high trust level as users unknowingly run these containers

**Permission Bypass Technique:**
- Artifact Registry successor to Container Registry created automatic migration tools
- gcr.io repositories maintain same domain for backward compatibility
- Permission discrepancy allows listing images at gcr.io even without docker.pkg.dev permissions
- Technique works even with restricted repository access permissions

**Vulnerability Analysis:**
- 1.7 million total vulnerabilities across 3,000 images
- 350,000 unique CVEs identified
- 380,000 high-severity vulnerabilities
- 70,000 critical-severity vulnerabilities
- Notable findings: Log4Shell, ZeroLOG, Spring4Shell on multiple images
- Example: Security scanning company had 24 critical vulnerabilities with 9 potential RCE vectors

**Secret Exposure Findings:**
- Nearly 3,000 secrets found (approximately 1 per image scanned)
- Categories: cloud credentials, authentication tokens, API keys, hardcoded credentials, private keys
- Cloud provider coverage: AWS, Azure, GCP credentials found
- AI service tokens: OpenAI API keys discovered
- Development tools: Docker configurations, Git private access tokens
- Administrative access: Username/password combinations for admin accounts

**Specific Secret Example:**
- Configuration file containing multiple API keys
- OpenAI API key for AI services
- AWS and Azure cloud credentials
- Jira authentication token  
- Hardcoded administrator username and password

**Shared Responsibility Confusion:**
- Google documentation states partners must not include known vulnerabilities
- Google also claims to review and scan VM images for vulnerabilities during submission
- Both entities responsible for same security aspect creates accountability gaps
- Result: security falls between organizational cracks

**Google Response:**
- Used category images verified as non-exploitable or non-relevant to GCP users
- Vetted category issues deemed outside Google ability to determine exploitability
- No immediate remediation actions taken for marketplace images
- Precedent exists in Google Play for removing non-compliant applications

**Detection and Monitoring:**
- Artifact Registry includes built-in vulnerability scanning capabilities
- Users should audit unknown images in their environments
- Continuous monitoring required as image releases are ongoing process
- Verification needed for images appearing in environments without explicit deployment

**Recommendations for Users:**
- Never assume trust based on Google association alone
- Use Artifact Registry built-in vulnerability scanning tools
- Audit all container images including automatically deployed ones
- Verify source and ownership of all images in environment
- Implement continuous security scanning processes

**Recommendations for Developers:**
- Scan images for secrets before uploading to any registry
- Avoid hardcoded credentials in container images
- Implement proper security checks in development lifecycle
- Regular vulnerability assessment and patching processes
- Remember that product releases require continuous security maintenance

**Future Implications:**
- Enterprise scale deployment considerations for automated image verification
- Integration challenges with existing CI/CD and Terraform workflows
- Need for better tooling to extract and verify policies before deployment
- Regression testing capabilities against historical cloud activity logs

## Full Transcript

All right, everybody. Welcome, welcome. If you want to grab your seats, um, and, uh, just so you know, in case you missed the screen here, you're here for I didn't register for this. What's really in Google's artifact registry? Um, and, uh, just want to go ahead and start by thanking one of our sponsors here for this talk. Um, Sweet Security. Um, Sweet Security, you can find out more information about them if you want to chat with them out there in uh, in the lobby. Um uh and in addition to that any questions uh for for the speaker or for the talk afterwards um you can um just hold those till the end. I'll bring the microphone around and uh we'll get your questions answered and then also on Slack if you want to ask a question there please feel free to do so. U without further ado uh welcome to uh Moshe Bernstein. I didn't register for this what's really in Google's Google's artifact registry. Thank you so much. Um, as mentioned, welcome to I didn't register for this. What's really in Google's artifact registry, where I will share with you how I scanned all of the container images owned by Google on artifact registry and what I was able to find. I personally think it's quite fair to assume that container images uploaded by Google to their own platform, which has built-in security features, probably wouldn't have the worst security issues out there, right? Well, it turns out it's actually not that simple. My name is Mosha Bernstein and I am a cloud vulnerability researcher at Teneal Cloud Security. Uh I actually have been in in Tennibal for only a year or so but uh I have close to a decade of experience in cyber security in a variety of roles mostly around web vulnerability research, cloud security and networking. And in my spare time I enjoy playing sports, playing video games and traveling. If anybody here has a particular interest in table tennis or Smash Bros. hit me up afterwards. So, what are we going to go over today? Well, we'll start with a quick introduction and explain how I actually got into this research and dive into the artifact registry rabbit hole. Then, we'll go over the discovery process and I'll showcase an interesting permission discrepancy that I was able to find which helped me out with discovering more images. Then, we'll go into the classification and explain what constitutes a Google image. We created three unique categories to help us understand a little bit better what's going on in these images. Then the juicy part. We'll dive into the findings that we were able to locate, the vulnerabilities and the secrets. And at last, the final thoughts where I will share some interesting questions about the the shared responsibility model and ideas for the future. So you're all cloud security professionals. I'm not going to dive too deep into artifact registry. I'm sure you're familiar, but I will just give a quick recap in case u somebody doesn't remember. Artifact Registry is Google's package and image solution. Um, there are convenient management and version controls and there is great CI/CD integration and Google Cloud integration and built-in security features. So, how did I actually get to do this research? Me and a co-orker of mine were doing an unrelated research into a service called Google Composer 3. Composer, for those of you who are unfamiliar, is a managed Apache Airflow service. Composer 3 in particular runs in something called tenant project. Tenant project is a project that is hosted in Google's environment. While we were poking around in there, we found this interesting Kubernetes configuration file with the following line importing an image from artifact registry, specifically from a project named cloud airflow releaser airflow worker scheduler 291. This image piqued my interest since I knew that this image was being deployed into Google production environments. So I decided to check it out on artifact registry. This is the artifact registry UI. And naturally once I realized that I had read permissions, I wanted to find out as much as I could. So I clicked this show more button over here. And once you click that button, you find tags that are associated with this image. Two tags in particular piqu my interest. GCP environment with the value prod and GCP product with the value cloud composer. If I were to click on these tags, I would find that these tags are actually inherited from a parent with the ID starting with 433. If anybody were to look this ID up, you would find that this ID actually belongs to Google and it's their organizational ID. So with all these context clues, we can pretty much understand that this is an image that was uploaded by Google to their own repository and is actually being deployed in cloud production environments. If I were to find another image with similar attributes, um it could be pretty interesting to scan these types of images for security issues and it could be a great lead into further research. So that's how I decided to do this research and naturally I wanted to find as many images as I could. So I tried to find the rest of the images within this project and when I browsed to the project I found that I was missing the permissions to do so. Specifically I was missing the artifact registry repositories list permission. I was actually able to find a pretty cool trick to get around this issue and I need to share a little bit of background with you first before I can tell you how I did that. So for those of you who are unfamiliar, artifact registry is actually a successor to a previous Google service called container registry. Container registry used to only host container images and Google wanted to upgrade their service to allow for more types of artifacts and have just a better more modern product. So they created some automatic migration tools from container registry to artifact registry to help the GCP users migrate over from there. But like we all are a little bit lazy um GCP users didn't really want to have to change all of their deployment environments and change the domain from gcr.io IO to docker package dev which is artifact registries domain. So Google created this unique tool called gcr.io repositories where you can create a gcr.io repository in your artifact registry project and then all of the container images that you migrated from gcr will actually be hosted on the same domain that they used to be back when it was gcr.io. So back to where we were. If I were to browse to US Docker package dev, which is artifact registries domain, I found that I couldn't have any permissions to list the other images in the repository. But what happens if I browse to gcr.io? Well, turns out that the permission discrepancy between the reposi the gcr.io repository and the project allows me to actually see a whole lot of other images that were existing in this repository. And this way, even if I just have one image that I find, I might be able to actually bypass the permission issues and find many, many more images to scan. Using all of the things that we learned up until now, we're able to create an image discovery and scanning pipeline. You start by discovering a potential image. You can do this through a variety of means, whether it be scanning your own personal cloud environments, looking it up on Google, or checking open source repositories and code. Once you found an image, you can verify that it actually belongs to Google and is maintained by Google, checking the organizational ID like we did with the tags. Once you find that it does belong to Google, you might want to try and find other images within the same project using the gcr.io trick, even if you don't have permissions to do so. And lastly, just scan and see what you find. We were actually able to find quite a few images this way, and I will share that the results with you soon. But first, we decided to classify them into three different categories of images that will help us a little understand a little bit what these images are used for and what the repercussions of the issues are. So the first category and by far the most popular category is the vetted category. The classic example for this is the GCP cloud marketplace. For those of you unfamiliar, GCP cloud marketplace is kind of like GCP's app store. Thirdparty software developers can create container images and offer them through Google's platform and offer the billing through Google as well. The images are created by the third parties but they are curated by Google and uploaded by Google to artifact registry. This carries a high level of trust because they are being offered by Google on their own platform. The second category is the offered category. These are not actually images which are used in production environments. These are images created by Google just for the convenience of its users. Say you want to use a base operating system image or a AI training image. Google offers these kinds of bare bones images for its users and they upload them to artifact registry as well. Since Google are the ones who are offering these images to you again the trust level for this is high. The final category, perhaps the most interesting one to me, is the used category and this would include the cloud composer image that we saw earlier. These are images which are created by Google to be used by them in their production environments. The trust level for this category is actually very high since GCP users might actually have these containers deployed in their environment without being aware of it. If I were to just spin up a cloud composer service, these containers might be used in my environment and I don't even know it. As we can see, all three of these categories carry the high level of trust with them. Imagine you're a user on GCP and you're trying to bring a container image into your environment. You see an image that is actually uploaded to the platform by Google themselves. I feel like it's pretty safe to assume that that image is trustworthy, right? Well, let's find out. So, we were able to find and scan over 3,000 images from 32 repositories using these techniques. We have uh around 70% of them in the vetted category and the minority in the offered and the used categories. Vulnerabilities. What vulnerabil vulnerabilities were we able to find on these images? We were able to find around 1.7 million vulnerabilities on 3,000 images which are owned by Google on their own platform. So these are this is a huge number. But if we were to narrow it down a little bit to unique numbers, 350,000 unique vulnerabilities, that means 350,000 CVEes exist on only 3,000 images which are owned by Google. Um, but you might be looking at the graph and you might be thinking, you know, Moshe, most of these are medium or low severity. Like, I don't really care. But even if we were only to filter through high and critical vulnerabilities, we see that we have 380,000 and around 70,000 unique vulnerabilities. This is still a very big number. And anybody who's dealt with vulnerability management in the past knows that not all vulnerabilities are the same. You might be thinking, you know, surely a lot of these are just in esoteric parts of the container and they're not exploitable. But I'm actually not talking about those kinds of vulnerabilities. These are just a few of the examples of vulnerabilities we were able to find on these images. Log for shell, zero loon, spring for shell. These are some of the most infamous and exploitable vulnerabilities out there. Extremely easy to patch and extremely wellknown. And we found them on multiple images uploaded by Google to their own environment. Surely most of you have heard of at least one of these vulnerabilities. I know you can't read anything in this table, but we're going to dive into a specific image that we were able to find on Google Cloud Marketplace. These are 24 critical vulnerabilities that we found on this image. Of those, nine nine of the vulnerabilities could potentially lead to remote code execution. What's the interesting part about this and why am I sharing it with you? Well, actually the software company which created this image and uploaded it to cloud marketplace is a company that creates a product that helps scan container images for vulnerabilities. Talk about irony in cyber security. Am I right? Next, we'll dive into the secrets that we were able to find. All of the secrets we were able to find were actually in the vetted category. So it makes sense because when you think about it in the offered category of the barebones containers, there's not much secrets to be had over there. And in the used category, presumably Google has some pretty strict security pipelines that allow them to scan for these kinds of things. But the third party defenders who are uploading their images to cloud marketplace might not have the same checks in place. So we were able to find almost 3,000 secrets um which is about the same number of images that we scanned. And of those, there were plenty of interesting categories. Be it cloud credentials, authentication tokens, API keys, even hard-coded credentials, and private keys. Again, well, these are some of the examples of different types of secrets. We were able to find um authentication for all three major cloud providers, AI tokens, Docker configurations, Git private access tokens, you name it. We'll dive into another specific example. And I know again you can't really read what it says there, but I'll highlight what's interesting, which is actually everything. Um, this is a configuration file that we found on one of the images uploaded to cloud marketplace. These guys are all API keys. This is an open AI API key specifically. Here we have cloud credentials for AWS and Azure, a Jira token, and finally the cherry on top hard-coded administrator credentials, the username and the password. Now, you might be thinking to yourself, these are secrets that belong to the third party software developers. Why should I care? It's not Google secrets. It's not customer data. But ultimately, we need to remember these are not random companies. These are companies that are official cloud marketplace partners. An account takeover takeover for a company like this could actually lead to a devastating supply chain attack down the line to GCP users. That's why you should care. So we just saw two pretty egregious examples of security issues in cloud marketplace container images. That raises the question, who should actually be responsible for the security of these images? Well, on the one hand, if you look at the documentation for the Google Cloud Marketplace partner um documentation in the requirements for your product part, it says your product must not include known vulnerabilities. This would help us believe that the partners are the ones who are responsible for securing their own images, right? But in another part of the documentation, specifically in the review process, it says that when you submit your product, the cloud marketplace team reviews your VM scanning your VM image for vulnerabilities. So here we have two different entities which are both responsible for securing the same thing. And as we know, sometimes when two things are responsible for the same security, as we were able to see, nobody secures it. It falls between the cracks. We actually disclosed all of this information to Google and um they went ahead and made sure that all of the used category images were not in fact dangerous to any GCP users in the end. Um and the vulnerabilities there were either non-exloitable or not relevant. And uh in terms of the vetted category, which was the worst offender, um they decid they said that they were not in a position to determine whether or not the vulnerabilities were exploitable and therefore they couldn't do very much about it. Um we actually personally love working with Google and the amount of effort that they put into their security is really inspiring and um there is a precedent in Google Play where some severe security issues um happened on some um Android applications and they created a deadline where if the developers were not to fix the vulnerabilities in time their apps would be removed from play store. So I personally believe in Google and hope that they might implement something similar in the future for artifact registry. You might be thinking what can I do right? So I don't know if anybody here is a security practitioner or a developer that uses cloud marketplace but if you are please ensure that you do the proper security checks before uploading your container image to artifact registry. Ultimately um the security is not only for your own company but also for your customers down the line. Um, definitely scan your image for secrets. I feel like I shouldn't even have to say that. Don't upload your hard-coded administrator username and password to a public repository. Um, and remember that releasing a product is actually continuous work. It's not something that you can just, you know, set it and forget it. You have to constantly be updating if there are new vulnerabilities and new versions for your software. And if you're an Artifact Registry user, um, ironically, Artifact Registry actually has a built-in vulnerability scanning tool. Somebody should probably tell Google that. Um, but be sure to use it whenever you can. And, um, just there might be images in your environment that you're not actually familiar with. So, just make sure to audit and kind of check in all the time and figure out where the images are from. And just some final takeaways. Um, there should never be any assumed trust. Just because something is uploaded to artifact registry by Google doesn't necessarily mean that is inherently secure. Please accept assume the trust. Um there shouldn't be assume trust. You have to earn the trust. And as we spoke about the state of shared responsibility. Too many cooks spoil the broth. Um ultimately the responsibility for protecting your cloud images is your own. As we saw, nobody really is taking responsibility for this. So it's important that you do. And thank you so much. Um, I really appreciate you guys choosing to come to my talk over everything else. Uh, this is actually my first speaking opportunity at a security conference. So, thank you. Any questions? Appreciate it. Awesome. Thank you, Mosher. Appreciate it. Uh, got a good kick off some questions here from one in the Slack that we've got. Um, so it says of the vulnerability counts presented, how many were present on older versions of those images versus the most recent image in the registry. Also curious about whether the most severe/wellknown/exploitable vones were present in the most recent tags. Um, and then it says, if these vones were present on earlier image releases, are you suggesting that older ones should be deleted outright or maybe flagged as deprecated or something? Um, that's an amazing question. Actually, I probably should have spoken about this, but um as part of the discovery process, what we did was um just take the latest tag um of the repository like for every image. So many many of these images um as all even in the vetted category which had the worst offenders are updated and you know actively maintained and you can rest assured that the data comes from the latest image available. even if it is an old image, it's still the latest available. All right. And then there's just one other note on the thread here just mentioning that um yourself and and maybe Seth Art uh who presented as well should have some collaboration on on a database. Definitely investigator.cloud. I mean if I would be honored to be able to work with Seth on something, so if he wants to, it's a pleasure. Awesome. I know. Yeah. Oh, there we go. I'm excited to see him here. Awesome. And then um I got another question on Slack and then I'll open it to the room as well. Um the question here says, "Did you test any of those secrets or keys?" Um great question. Um we tested a few just to make sure that they were actually active. Um but ultimately this belongs to, you know, third party software developers. We don't have a relationship with them and they don't have vulnerability reward program or anything like that. We didn't want to mess with it too much. Um we reported everything to Google and let them handle that. All right. And then for the group here. Yes. So besides what you said about um it's our responsibility for you know securing everything which we all have responsibility for security is what I believe. But um I'm curious about how you feel about the shared responsibility model that you touched on as we kind of rely on that some of our you know contractual agreements and things like that. um if it if it I'm just curious what you think of the shared responsibility model and then what they're saying about kind of doubling down on both options that you showed up there as far as who's responsible. Yeah. So I mean the shared responsibility model in my opinion is really idealistic and it's great. Um and definitely the cloud providers assume a lot of responsibility but there's a lot of gray areas like the one that we saw where it's not really clear who actually should be the one taking responsibility. And in those areas, I think it's up to us to understand um where they might be and how we can defend the best about against them. And um you know, Google are really really trying their best to secure their environment like we know that we work with them all the time. Um but some things are just you know it's too much and the the the developers and the users need to accept a little bit of the responsibility as well. Okay. I was going to put you on the spot and do say do you think it's Google's responsibility to maintain their own registry even with their vulnerability scanner that's optional or an option in the registry? I mean they offer you the Okay, I mean it's I wish I had a better insight into it. It's it's above my pay grade. I can answer that question if you'd like. Yeah, we can all link up later and do a birds of a feather on the ro shared responsibility model. Awesome. Awesome research. Um question about the initial vulnerability about being able to identify the um packages with the GCR domain kind of bypassing the restrictions on the Docker package dev. Did you report that to Google? What was the response? Has that been wrapped up? So essentially it's kind of a interesting situation because on paper it's working as intended since there are um the gcr.io images are stored in a repository and I did have permissions to list images within a repository but what I didn't have permissions was to list further repositories and the rest of the images in artifact registry are all stored in their own repository. So I had no way of discovering any other images since I had no way of listing other repositories. But knowing that the gcr.io repository exists allowed me to list the images that were migrated over from container registry. Did you get a documentation update for that? Um no I did not. Okay. All right. Any other questions? We got one back here. See make sure we got some time here. Yeah, thank you. What is your recommendations uh in the marketplace? Uh they should be scanning their products weekly, monthly, quarterly. I mean it honestly like they should be scanning it all the time, right? as the as soon as there's new vulnerabilities released every day, like you want to stay updated and know exactly what's going on in your container images. Um, a responsible, you know, software development life cycle includes constantly scanning for security issues. So, I wouldn't put a specific timeline on on it. I would just say, you know, do it as much as you can. Yeah. But, uh, there's a process for uh testing also, right? So you find a vulnerability, so you're going to go fix it, then test it out from dev, QA to production. Uh, sorry, could you repeat the question a little bit closer to the microphone? I What I'm saying is like I I know you if you scan it, right? Let's say daily to to put the fix, you have to go through a life cycle, right? Dev, QA, production, right? Then put into the marketplace. That could take, you know, a couple of like a week a minimum. Yeah. Well, of course, but it's like that for any company, right? Any any software developer that uses a package that has a vulnerability, it takes time to update, but you know, when there's a critical issue, you have to drive it a little bit faster, right? It's it's it's not any different for cloud marketplace in my opinion. All right. Well, if you got any more questions, you'd like to continue the conversation, I think it's great. Uh be sure to meet up with Moshe after and maybe ask some some follow-ups. But, uh thank you again. We really appreciate it. Another round of applause for uh for Moshe.